{"version":3,"sources":["../../../src/datasource-zabbix/zabbix/zabbix.js"],"names":["findByName","list","name","finded","_","find","filterByName","filter","filterByRegex","regex","filterPattern","utils","buildRegex","zbx_obj","test","findByFilter","isRegex","filterByQuery","getHostIds","items","hostIds","map","item","hosts","uniq","flatten","responseHandler","ZabbixAPIConnector","SQLConnector","CachingProxy","ZabbixNotImplemented","REQUESTS_TO_PROXYFY","REQUESTS_TO_CACHE","REQUESTS_TO_BIND","Zabbix","options","backendSrv","datasourceSrv","url","username","password","basicAuth","authpassthru","withCredentials","cacheTTL","enableDirectDBConnection","dbConnectionDatasourceId","dbConnectionDatasourceName","cacheOptions","enabled","ttl","cachingProxy","zabbixAPI","dbConnectorOptions","datasourceId","datasourceName","dbConnector","getHistoryDB","proxyfyWithCache","getHistory","getTrendsDB","getTrends","proxyfyRequests","cacheRequests","bindRequests","request","proxyfy","cacheRequest","bind","zabbixVersion","dbConnectorStatus","getVersion","then","version","login","testDataSource","Promise","resolve","catch","error","reject","testResult","dsType","datasourceTypeName","dsName","target","parts","filters","p","getItems","all","getHosts","getApps","results","apps","appFilterEmpty","getGroups","groupFilter","getAllGroups","groups","groupids","hostFilter","getAllHosts","hostids","appFilter","undefined","itemtype","appids","showDisabledItems","expandUserMacro","getMacros","forEach","containsMacro","replaceMacro","macros","itemFilter","getAllItems","itServiceFilter","getITService","itServices","promises","filteredGroups","filteredHosts","filteredApps","query","applicationids","getTriggers","timeRange","timeFrom","timeTo","handleGrafanaTSResponse","history","handleHistory","valueType","consolidateBy","getTrend","handleTrends","sortTimeseries","length","resultFormat","handleHistoryAsTable","handleText","itservices","isOldVersion","itservice","serviceid","itServiceIds","getSLA","handleSLAResponse","slaProperty","slaResponse"],"mappings":"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","file":"zabbix.js","sourcesContent":["import _ from 'lodash';\nimport * as utils from '../utils';\nimport responseHandler from '../responseHandler';\nimport { ZabbixAPIConnector } from './connectors/zabbix_api/zabbixAPIConnector';\nimport { SQLConnector } from './connectors/sql/sqlConnector';\nimport { CachingProxy } from './proxy/cachingProxy';\nimport { ZabbixNotImplemented } from './connectors/dbConnector';\n\nconst REQUESTS_TO_PROXYFY = [\n  'getHistory', 'getTrend', 'getGroups', 'getHosts', 'getApps', 'getItems', 'getMacros', 'getItemsByIDs',\n  'getEvents', 'getAlerts', 'getHostAlerts', 'getAcknowledges', 'getITService', 'getSLA', 'getVersion'\n];\n\nconst REQUESTS_TO_CACHE = [\n  'getGroups', 'getHosts', 'getApps', 'getItems', 'getMacros', 'getItemsByIDs', 'getITService'\n];\n\nconst REQUESTS_TO_BIND = [\n  'getHistory', 'getTrend', 'getMacros', 'getItemsByIDs', 'getEvents', 'getAlerts', 'getHostAlerts',\n  'getAcknowledges', 'getITService', 'getVersion', 'login'\n];\n\nexport class Zabbix {\n  constructor(options, backendSrv, datasourceSrv) {\n    let {\n      url,\n      username,\n      password,\n      basicAuth,\n      authpassthru,\n      withCredentials,\n      cacheTTL,\n      enableDirectDBConnection,\n      dbConnectionDatasourceId,\n      dbConnectionDatasourceName,\n    } = options;\n\n    this.enableDirectDBConnection = enableDirectDBConnection;\n\n    // Initialize caching proxy for requests\n    let cacheOptions = {\n      enabled: true,\n      ttl: cacheTTL\n    };\n    this.cachingProxy = new CachingProxy(cacheOptions);\n\n    this.zabbixAPI = new ZabbixAPIConnector(url, username, password, basicAuth, withCredentials, authpassthru, backendSrv);\n\n    if (enableDirectDBConnection) {\n      let dbConnectorOptions = {\n        datasourceId: dbConnectionDatasourceId,\n        datasourceName: dbConnectionDatasourceName\n      };\n      this.dbConnector = new SQLConnector(dbConnectorOptions, backendSrv, datasourceSrv);\n      this.getHistoryDB = this.cachingProxy.proxyfyWithCache(this.dbConnector.getHistory, 'getHistory', this.dbConnector);\n      this.getTrendsDB = this.cachingProxy.proxyfyWithCache(this.dbConnector.getTrends, 'getTrends', this.dbConnector);\n    }\n\n    this.proxyfyRequests();\n    this.cacheRequests();\n    this.bindRequests();\n  }\n\n  proxyfyRequests() {\n    for (let request of REQUESTS_TO_PROXYFY) {\n      this.zabbixAPI[request] = this.cachingProxy.proxyfy(this.zabbixAPI[request], request, this.zabbixAPI);\n    }\n  }\n\n  cacheRequests() {\n    for (let request of REQUESTS_TO_CACHE) {\n      this.zabbixAPI[request] = this.cachingProxy.cacheRequest(this.zabbixAPI[request], request, this.zabbixAPI);\n    }\n  }\n\n  bindRequests() {\n    for (let request of REQUESTS_TO_BIND) {\n      this[request] = this.zabbixAPI[request].bind(this.zabbixAPI);\n    }\n  }\n\n  /**\n   * Perform test query for Zabbix API and external history DB.\n   * @return {object} test result object:\n   * ```\n    {\n      zabbixVersion,\n      dbConnectorStatus: {\n        dsType,\n        dsName\n      }\n    }\n   ```\n   */\n  testDataSource() {\n    let zabbixVersion;\n    let dbConnectorStatus;\n    return this.getVersion()\n    .then(version => {\n      zabbixVersion = version;\n      return this.login();\n    })\n    .then(() => {\n      if (this.enableDirectDBConnection) {\n        return this.dbConnector.testDataSource();\n      } else {\n        return Promise.resolve();\n      }\n    })\n    .catch(error => {\n      if (error instanceof ZabbixNotImplemented) {\n        return Promise.resolve();\n      }\n      return Promise.reject(error);\n    })\n    .then(testResult => {\n      if (testResult) {\n        dbConnectorStatus = {\n          dsType: this.dbConnector.datasourceTypeName,\n          dsName: this.dbConnector.datasourceName\n        };\n      }\n      return { zabbixVersion, dbConnectorStatus };\n    });\n  }\n\n  getItemsFromTarget(target, options) {\n    let parts = ['group', 'host', 'application', 'item'];\n    let filters = _.map(parts, p => target[p].filter);\n    return this.getItems(...filters, options);\n  }\n\n  getHostsFromTarget(target) {\n    let parts = ['group', 'host', 'application'];\n    let filters = _.map(parts, p => target[p].filter);\n    return Promise.all([\n      this.getHosts(...filters),\n      this.getApps(...filters),\n    ]).then((results) => {\n      let [hosts, apps] = results;\n      if (apps.appFilterEmpty) {\n        apps = [];\n      }\n      return [hosts, apps];\n    });\n  }\n\n  getAllGroups() {\n    return this.zabbixAPI.getGroups();\n  }\n\n  getGroups(groupFilter) {\n    return this.getAllGroups()\n    .then(groups => findByFilter(groups, groupFilter));\n  }\n\n  /**\n   * Get list of host belonging to given groups.\n   */\n  getAllHosts(groupFilter) {\n    return this.getGroups(groupFilter)\n    .then(groups => {\n      let groupids = _.map(groups, 'groupid');\n      return this.zabbixAPI.getHosts(groupids);\n    });\n  }\n\n  getHosts(groupFilter, hostFilter) {\n    return this.getAllHosts(groupFilter)\n    .then(hosts => findByFilter(hosts, hostFilter));\n  }\n\n  /**\n   * Get list of applications belonging to given groups and hosts.\n   */\n  getAllApps(groupFilter, hostFilter) {\n    return this.getHosts(groupFilter, hostFilter)\n    .then(hosts => {\n      let hostids = _.map(hosts, 'hostid');\n      return this.zabbixAPI.getApps(hostids);\n    });\n  }\n\n  getApps(groupFilter, hostFilter, appFilter) {\n    return this.getHosts(groupFilter, hostFilter)\n    .then(hosts => {\n      let hostids = _.map(hosts, 'hostid');\n      if (appFilter) {\n        return this.zabbixAPI.getApps(hostids)\n        .then(apps => filterByQuery(apps, appFilter));\n      } else {\n        return {\n          appFilterEmpty: true,\n          hostids: hostids\n        };\n      }\n    });\n  }\n\n  getAllItems(groupFilter, hostFilter, appFilter, options = {}) {\n    return this.getApps(groupFilter, hostFilter, appFilter)\n    .then(apps => {\n      if (apps.appFilterEmpty) {\n        return this.zabbixAPI.getItems(apps.hostids, undefined, options.itemtype);\n      } else {\n        let appids = _.map(apps, 'applicationid');\n        return this.zabbixAPI.getItems(undefined, appids, options.itemtype);\n      }\n    })\n    .then(items => {\n      if (!options.showDisabledItems) {\n        items = _.filter(items, {'status': '0'});\n      }\n\n      return items;\n    })\n    .then(this.expandUserMacro.bind(this));\n  }\n\n  expandUserMacro(items) {\n    let hostids = getHostIds(items);\n    return this.getMacros(hostids)\n    .then(macros => {\n      _.forEach(items, item => {\n        if (utils.containsMacro(item.name)) {\n          item.name = utils.replaceMacro(item, macros);\n        }\n      });\n      return items;\n    });\n  }\n\n  getItems(groupFilter, hostFilter, appFilter, itemFilter, options = {}) {\n    return this.getAllItems(groupFilter, hostFilter, appFilter, options)\n    .then(items => filterByQuery(items, itemFilter));\n  }\n\n  getITServices(itServiceFilter) {\n    return this.zabbixAPI.getITService()\n    .then(itServices => findByFilter(itServices, itServiceFilter));\n  }\n\n  /**\n   * Build query - convert target filters to array of Zabbix items\n   */\n  getTriggers(groupFilter, hostFilter, appFilter, options) {\n    let promises = [\n      this.getGroups(groupFilter),\n      this.getHosts(groupFilter, hostFilter),\n      this.getApps(groupFilter, hostFilter, appFilter)\n    ];\n\n    return Promise.all(promises)\n    .then(results => {\n      let filteredGroups = results[0];\n      let filteredHosts = results[1];\n      let filteredApps = results[2];\n      let query = {};\n\n      if (appFilter) {\n        query.applicationids = _.flatten(_.map(filteredApps, 'applicationid'));\n      }\n      if (hostFilter) {\n        query.hostids = _.map(filteredHosts, 'hostid');\n      }\n      if (groupFilter) {\n        query.groupids = _.map(filteredGroups, 'groupid');\n      }\n\n      return query;\n    }).then(query => {\n      return this.zabbixAPI.getTriggers(query.groupids, query.hostids, query.applicationids, options);\n    });\n  }\n\n  getHistoryTS(items, timeRange, options) {\n    let [timeFrom, timeTo] = timeRange;\n    if (this.enableDirectDBConnection) {\n      return this.getHistoryDB(items, timeFrom, timeTo, options)\n      .then(history => this.dbConnector.handleGrafanaTSResponse(history, items));\n    } else {\n      return this.zabbixAPI.getHistory(items, timeFrom, timeTo)\n      .then(history => responseHandler.handleHistory(history, items));\n    }\n  }\n\n  getTrends(items, timeRange, options) {\n    let [timeFrom, timeTo] = timeRange;\n    if (this.enableDirectDBConnection) {\n      return this.getTrendsDB(items, timeFrom, timeTo, options)\n      .then(history => this.dbConnector.handleGrafanaTSResponse(history, items));\n    } else {\n      let valueType = options.consolidateBy || options.valueType;\n      return this.zabbixAPI.getTrend(items, timeFrom, timeTo)\n      .then(history => responseHandler.handleTrends(history, items, valueType))\n      .then(responseHandler.sortTimeseries); // Sort trend data, issue #202\n    }\n  }\n\n  getHistoryText(items, timeRange, target) {\n    let [timeFrom, timeTo] = timeRange;\n    if (items.length) {\n      return this.zabbixAPI.getHistory(items, timeFrom, timeTo)\n      .then(history => {\n        if (target.resultFormat === 'table') {\n          return responseHandler.handleHistoryAsTable(history, items, target);\n        } else {\n          return responseHandler.handleText(history, items, target);\n        }\n      });\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  getSLA(itservices, timeRange, target, options) {\n    let itServices = itservices;\n    if (options.isOldVersion) {\n      itServices = _.filter(itServices, {'serviceid': target.itservice.serviceid});\n    }\n    let itServiceIds = _.map(itServices, 'serviceid');\n    return this.zabbixAPI.getSLA(itServiceIds, timeRange)\n    .then(slaResponse => {\n      return _.map(itServiceIds, serviceid => {\n        let itservice = _.find(itServices, {'serviceid': serviceid});\n        return responseHandler.handleSLAResponse(itservice, target.slaProperty, slaResponse);\n      });\n    });\n  }\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Find group, host, app or item by given name.\n * @param  list list of groups, apps or other\n * @param  name visible name\n * @return      array with finded element or empty array\n */\nfunction findByName(list, name) {\n  var finded = _.find(list, {'name': name});\n  if (finded) {\n    return [finded];\n  } else {\n    return [];\n  }\n}\n\n/**\n * Different hosts can contains applications and items with same name.\n * For this reason use _.filter, which return all elements instead _.find,\n * which return only first finded.\n * @param  {[type]} list list of elements\n * @param  {[type]} name app name\n * @return {[type]}      array with finded element or empty array\n */\nfunction filterByName(list, name) {\n  var finded = _.filter(list, {'name': name});\n  if (finded) {\n    return finded;\n  } else {\n    return [];\n  }\n}\n\nfunction filterByRegex(list, regex) {\n  var filterPattern = utils.buildRegex(regex);\n  return _.filter(list, function (zbx_obj) {\n    return filterPattern.test(zbx_obj.name);\n  });\n}\n\nfunction findByFilter(list, filter) {\n  if (utils.isRegex(filter)) {\n    return filterByRegex(list, filter);\n  } else {\n    return findByName(list, filter);\n  }\n}\n\nfunction filterByQuery(list, filter) {\n  if (utils.isRegex(filter)) {\n    return filterByRegex(list, filter);\n  } else {\n    return filterByName(list, filter);\n  }\n}\n\nfunction getHostIds(items) {\n  let hostIds = _.map(items, item => {\n    return _.map(item.hosts, 'hostid');\n  });\n  return _.uniq(_.flatten(hostIds));\n}\n"]}